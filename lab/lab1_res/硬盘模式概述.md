# LBA模式
    LBA(Logical Block Addressing)逻辑块寻址。在 LBA 模式下，我们知道硬盘上的一个数据区域由它所在的磁头、柱面（也就是磁道）和扇区所唯一确定。早期系统就是直接使用磁头、柱面和扇区来对硬盘进行寻址（这称为CHS寻址），这需要分别存储每个区域的三个参数（这称为3D参数），使用时再分别读取三个参数，然后再送到磁盘控制器去执行。由于系统用8b来存储磁头地址，用10b来存储柱面地址，用6b来存储扇区地址，而一个扇区共有512B，这样使用CHS寻址一块硬盘最大容量为256 * 1024 * 63 * 512B = 8064 MB(1MB = 1048576B)（若按1MB=1000000B来算就是8.4GB）。随着硬盘技术的进步，硬盘容量越来越大，CHS模式无法管理超过8064 MB的硬盘，因此工程师们发明了更加简便的LBA寻址方式。在LBA地址中，地址不再表示实际硬盘的实际物理地址（柱面、磁头和扇区）。LBA编址方式将CHS这种三维寻址方式转变为一维的线性寻址，它把硬盘所有的物理扇区的C/H/S编号通过一定的规则转变为一线性的编号，系统效率得到大大提高，避免了烦琐的磁头/柱面/扇区的寻址方式。在访问硬盘时，由硬盘控制器再将这种逻辑地址转换为实际硬盘的物理地址。

    硬盘模式
    LARGE 大硬盘模式，在硬盘的柱面超过 1024 而又不为 LBA 支持时采用。LARGE 模式采用的方法是把 柱面数除以 2，把 磁头数乘以 2，其结果总容量不变。
    在这三种硬盘模式中，现在 LBA 模式使用最多。
    LBA与C/H/S 之间的转换:
    设NS为每 磁道 扇区数，NH为 磁头数，C、H、S分别表示磁盘的柱面、磁头和扇区编号，LBA表示逻辑扇区号，div为整除计算，mod为求余计算，则：
    LBA=NH×NS×C+NS×H+S-1；
    C=(LBA div NS)div NH；
    H=(LBA div NS)mod NH；
    S=(LBA mod NS)+1
    例如 LBA = 0 则 CHS = 0/0/1
    从C/H/S到LBA的计算公式：
    LBA=（C-CS）*PH*PS+（H-HS）*PS+(S-SS)

#PIO方式读取硬盘（包括CHS, 24-bit LBA, 48-bit LBA
    IDE通道1，读写0x1f0-0x1f7号端口

    IDE通道2，读写0x170-0x17f号端口

    

    CHS方式:

    写0x1f1: 0

    写0x1f2: 要读的扇区数

    写0x1f3: 扇区号

    写0x1f4: 柱面的低8位

    写0x1f5: 柱面的高8位

    写0x1f6: 7~5位,101,第4位0表示主盘,1表示从盘,3~0位,磁头号

    写0x1f7: 0x20为读, 0x30为写

    读0x1f7: 第4位为0表示读写完成，否则要一直循环等待

    读0x1f0: 每次读取1个word,反复循环，直到读完所有数据

    

    24-bit LBA方式:

    写0x1f1: 0

    写0x1f2: 要读的扇区数

    写0x1f3: LBA参数的0~7位

    写0x1f4: LBA参数的8~15位

    写0x1f5: LBA参数的16~23位

    写0x1f6: 7~5位,111,第4位0表示主盘,1表示从盘,3~0位,LBA参数的24~27位

    写0x1f7: 0x20为读, 0x30为写

    读0x1f7: 第4位为0表示读写完成，否则要一直循环等待

    读0x1f0: 每次读取1个word,反复循环，直到读完所有数据

    

    48-bit LBA方式:

    写两次0x1f1端口: 0

    写两次0x1f2端口: 第一次要读的扇区数的高8位,第二次低8位

    写0x1f3: LBA参数的24~31位

    写0x1f3: LBA参数的0~7位

    写0x1f4: LBA参数的32~39位

    写0x1f4: LBA参数的8~15位

    写0x1f5: LBA参数的40~47位

    写0x1f5: LBA参数的16~23位

    写0x1f6: 7~5位,010,第4位0表示主盘,1表示从盘,3~0位,0

    写0x1f7: 0x24为读, 0x34为写


# CHS模式
    硬盘的chs模式是指chs(Cylinder/Head/Sector)模式，很久以前， 硬盘的容量还非常小的时候，人们采用与软盘类似的结构生产硬盘。也就是硬盘盘片的每一条磁道都具有相同的扇区数。由此产生了所谓的3D参数 (Disk Geometry)：既磁头数(Heads)、柱面数(Cylinders)、扇区数(Sectors per track)，以及相应的寻址方式。其中：磁头数(Heads) 表示硬盘总共有几个磁头，也就是有几面盘片，最大为 256 (用 8 个二进制位存储)；柱面数(Cylinders) 表示硬盘每一面盘片上有几条磁道，最大为 1024(用 10 个二进制位存储)；扇区数(Sectors per track) 表示每一条磁道上有几个扇区， 最大为63 (用 6 个二进制位存储)。
    每个扇区一般是 512个字节，理论上讲这不是必须的，但好象没有取别的值的。所以磁盘最大容量为：
    256 * 1024 * 63 * 512 / 1048576 = 8064 MB ( 1M = 1048576 Bytes )
    或硬盘厂商常用的单位：
    256 * 1024 * 63 * 512 / 1000000 = 8455 MB ( 1M = 1000000 Bytes )
    在 CHS 寻址方式中， 磁头、柱面、 扇区的取值范围分别为 0 到 Heads-1，0 到 Cylinders-1，1 到 Sectors per track (注意是从 1 开始)。
    在 CHS 寻址方式中, 有以下几种尺寸单位：
    扇区 (Sector) = 512 字节 (一般情况下)
    磁道 (Track) = (Sectors per track) 扇区
    柱面 (Cylinder)= (Sectors per track) * Heads 扇区
    这种方式会浪费很多磁盘空间 (与软盘一样)。为了解决这一问题，进一步提高硬盘容量，人们改用等密度结构生产硬盘。也就是说，外圈磁道的扇区比内圈磁道多。采用这种结构后，硬盘不再具有实际的3D参数，寻址方式也改为线性寻址，即以扇区为单位进行寻址。
    为了与使用3D寻址的老软件兼容 (如使用BIOS Int13H接口的软件)，在硬盘控制器内部安装了一个地址翻译器，由它负责将老式3D参数翻译成新的线性参数。这也是为什么现在硬盘的3D参数可以有多种选择的原因 (不同的工作模式，对应不同的3D参数。如 LBA、LARGE、NORMAL)，CHS模式只能识别大硬盘的前面8G。LBA使用的线性寻址，突破了1024柱面的限制，能访问8G以外的空间了。
    ###################
    零磁道概念问题，涉及硬盘的物理结构和CHS 3D寻址方法。老硬盘一个磁道上分63个扇区，更老的还没63个扇区，物理磁头也就6-8个吧（3-4片盘片），再多硬盘里就装不下了。使用8位寻址方式，8位二进制数的最大值是256（0-255），用于表达磁头数；但实际只用255来表示磁头数。而扇区只有63个（1-63），用6位就可以表达了，还有二位就给柱面去用了，柱面数用10位来表达，达到1024（0-1023）。这也就是所谓的C（柱面）H（磁头）S（扇区） 3D参数。一般书写时按照CHS的次序来做，如0，0，1第一个0是0柱面，第二个0是的磁头（盘面）第三个1是1扇区。硬盘的实际物理磁头只有4个或6个，现在有些硬盘只有一个磁头，仅用一面。如果有块硬盘正好符合上面的8位寻址方式的最大值，可以想象这个硬盘有128片盘片，每个盘面上有1024个磁道，每个磁道上有63个扇区。这就是它的CHS 3D参数。顺便说一下由于受8位寻址的限制，采用8位寻址时的最大寻址空间为8.4G。（1024*255*63*512/1024/1024）目前 主板的BIOS已采用28位寻址，最大寻址空间137G，最前沿的主板BIOS采用48位寻址，已突破了137G的瓶颈。每个虚拟盘面上同一位置的磁道就称为柱面。如0，0，1，表示：第一个0，0柱面，是指位于128个盘片上的零磁道，但没讲是在那片盘上；第二个0，0磁头对应于0盘面，其实用盘面来理解更确切，1，1扇区，现在定位已完成。0，1，1，在刚才位置的反面。其实这些是不要我们操心的，硬盘内部的参数和主板BIOS之间会达成协议，正确发出寻址信号，正确定位磁道和扇区位置。 

        0，0，1指的是MBR所在的主引导扇区，零磁道从0，0，1-0，0，63，为真正的零磁道，它的位置一般做好后就不能用一般 软件来修改了，如果要改变，必须在固件区做相应修改，但这已不是一般用户能做的事，且需要用特殊的工具。它的读取是主板中BIOS通过INT19去读它的信息。0，1，1是DBR所在位置，这个扇区坏了，MS的OS就会说是“零磁道”损坏，其实这并不是零磁道，都是MS闯的祸。它坏了是可以用PCTOOLS等软件来修改这一起始位置，从而避开这一扇区。如果坚持0，1，1为0磁道，那岂不是要有255个0磁道？至少物理盘片的开始要称作零磁道吧。如果是这样定义叫硬盘怎样去找扇区？那就要大乱了。 

        老硬盘由于每磁道上只有63个扇区，甚至少于63个扇区；因此，外圈疏，内圈密，没有很好地利用盘面资源，现在磁盘内外圈密度相同，圈子上也不再是63个扇区了，不再用CHS 3D参数，一般都用LAB逻辑寻址方式，也有称作为线性寻址。传统意义上的零磁道，只是磁道上的一小段了，但有一点是相同的，一个硬盘必须有一个唯一的起点，那就是LAB 0扇区，对应于CHS的0，0，1。它坏了一般的软件就没办法了，但有些零磁道损坏的硬盘是可以通过用PC3000或别的软件来进行维修的，经物理扇区和逻辑扇区重定位，重新确定一个新的起点。圆方数据恢复中心在这方面有成功的例子，对某些品牌的硬盘分别使用了PC3K和其它软件成功修复了真正的零磁道损坏。但是也不是所有硬盘都能支持重定位。归根到底还是要硬盘本身支持才行。以前有文章称用PCTOOLS等软件来修复零磁道损坏的硬盘，其实这些软件改的并不是真正意义上零磁道，这一错误的观点一直在误导读者，流毒甚而为广深。不过这个错误的根源还在于M$的错。
    
    
> ***特别说明：在零磁道前还有负磁道，但它是厂家的硬盘参数区，一般使用者不能访问，更不能修改。***

# 硬盘的PIO模式和DMA模式

    IDE数据传输模式    
        随着技术的发展，产品对数据传输速度要求的提高，IDE接口硬盘的数据传输模式，经历过三个不同的技术
    变化，由最初的PIO模式，到DMA模式，再到Ultra DMA模式。
    PIO模式
        PIO的英文拼写是“Programming Input/Output Model”，PIO模式是一种通过CPU执行I/O端口指令来进行
    数据的读写的数据交换模式。是最早先的硬盘数据传输模式，数据传输速率低下，CPU占有率也很高，大量
    传输数据时会因为占用过多的CPU资源而导致系统停顿，无法进行其它的操作。PIO数据传输模式又分为PIO
    mode 0、PIO mode 1、PIO mode 2、PIO mode 3、PIO mode 4几种模式，数据传输速率从3.3MB/s到
    16.6MB/s不等。受限于传输速率低下和极高的CPU占有率，这种数据传输模式很快就被淘汰。
    DMA模式
    DMA的英文拼写是“Direct Memory Access”，汉语的意思就是直接内存访问，是一种不经过CPU而直接
    从内存了存取数据的数据交换模式。PIO模式下硬盘和内存之间的数据传输是由CPU来控制的；而在DMA模式
    下，CPU只须向DMA控制器下达指令，让DMA控制器来处理数的传送，数据传送完毕再把信息反馈给CPU，这
    样就很大程度上减轻了CPU资源占有率。DMA模式与PIO模式的区别就在于，DMA模式不过分依赖CPU，可以
    大大节省系统资源，二者在传输速度上的差异并不十分明显。DMA模式又可以分为Single-Word DMA（单字
    节DMA）和Multi-Word DMA（多字节DMA）两种，其中所能达到的最大传输速率也只有16.6MB/s。
    Ultra DMA模式
    Ultra DMA的英文拼写为“Ultra Direct Memory Access”，一般简写为UDMA，含义是高级直接内存访
    问。UDMA模式采用16-bit Multi-Word DMA（16位多字节DMA）模式为基准，可以理解为DMA模式的增强版
    本，它在包含了DMA模式的优点的基础上，又增加了CRC（Cyclic Redundancy Check循环冗余码校验）技
    术，提高数据传输过程中的准确性，安全性得到保障。在以往的硬盘数据传输模式下，一个时钟周期只传
    输一次数据，而在UDMA模式中逐渐应用了Double Data Rate（双倍数据传输）技术，因此数据传输速度有
    了极大的提高。此技术就是在时钟的上升期和下降期各自进行一次数据传输，可以是数据传输速度成倍的
    增长。
    在UDMA模式发展到UDMA133之后，受限于IDE接口的技术规范，无论是连接器、连接电缆、信号协议都表
    现出了很大的技术瓶颈，而且其支持的最高数据传输率也有限。同时在IDE接口传输率提高，也就是工作
    频率的提高，IDE接口交叉干扰、地线增多、信号混乱等缺陷也给其发展带来了很大的制约，被新一代的
    SATA接口取代也就在所难免了

    因此，DMA模式有着更快的速度和更低的CPU占用率